<!DOCTYPE html>
<html>
<head>
    <title>Debug API</title>
    <meta name="csrf-token" content="">
</head>
<body>
    <h1>Depuración de API</h1>
    
    <div style="margin-bottom: 20px;">
        <h2>1. Obtener carrito</h2>
        <button onclick="getCart()">Obtener carrito</button>
    </div>
    
    <div style="margin-bottom: 20px;">
        <h2>2. Añadir producto al carrito</h2>
        <label>ID del producto:</label>
        <input type="number" id="productId" value="1" min="1" style="width: 60px;">
        <label>Cantidad:</label>
        <input type="number" id="quantity" value="1" min="1" style="width: 60px;">
        <button onclick="addToCart()">Añadir al carrito</button>
    </div>
    
    <div style="margin-bottom: 20px;">
        <h2>3. Verificar Vue</h2>
        <button onclick="checkVue()">Verificar Vue</button>
    </div>
    
    <div id="results" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px; white-space: pre-wrap;"></div>

    <script>
        // Función para obtener el token CSRF
        function getCsrfToken() {
            return document.querySelector('meta[name="csrf-token"]')?.getAttribute("content") || '';
        }
        
        // Función para mostrar resultados
        function log(message) {
            var results = document.getElementById('results');
            results.innerHTML += message + '\n';
        }
        
        // Función para limpiar resultados
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // Obtener carrito
        function getCart() {
            clearResults();
            log('Obteniendo carrito...');
            
            fetch('/api/cart', {
                headers: {
                    'X-CSRF-TOKEN': getCsrfToken(),
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                credentials: 'include'
            })
            .then(function(response) {
                log('Status: ' + response.status);
                return response.json().catch(function() { return {}; });
            })
            .then(function(data) {
                log('Datos: ' + JSON.stringify(data, null, 2));
            })
            .catch(function(error) {
                log('Error: ' + error);
            });
        }
        
        // Añadir al carrito
        function addToCart() {
            clearResults();
            
            var productId = parseInt(document.getElementById('productId').value);
            var quantity = parseInt(document.getElementById('quantity').value);
            
            log('Añadiendo producto ' + productId + ' (cantidad: ' + quantity + ') al carrito...');
            
            fetch('/api/cart/add', {
                method: 'POST',
                headers: {
                    'X-CSRF-TOKEN': getCsrfToken(),
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                credentials: 'include',
                body: JSON.stringify({
                    product_id: productId,
                    quantity: quantity
                })
            })
            .then(function(response) {
                log('Status: ' + response.status);
                return response.json().catch(function() { 
                    log('No se pudo parsear la respuesta como JSON');
                    return {}; 
                });
            })
            .then(function(data) {
                log('Datos: ' + JSON.stringify(data, null, 2));
            })
            .catch(function(error) {
                log('Error: ' + error);
            });
        }
        
        // Verificar Vue
        function checkVue() {
            clearResults();
            log('Verificando Vue...');
            
            if (window.Vue) {
                log('✅ Vue 2 detectado');
                log('Versión: ' + Vue.version);
                
                // Verificar si hay componentes registrados globalmente
                if (Vue.options && Vue.options.components) {
                    log('Componentes registrados globalmente: ' + Object.keys(Vue.options.components).join(', '));
                }
                
                // Verificar si hay instancias de Vue en la página
                var vueElements = Array.from(document.querySelectorAll('*')).filter(function(el) { 
                    return el.__vue__; 
                });
                log('Elementos con instancias de Vue: ' + vueElements.length);
            } else if (window.__VUE__) {
                log('❌ Vue 3 detectado, pero estás intentando usar Vue 2');
            } else {
                log('❌ No se detectó ninguna versión de Vue');
            }
        }
    </script>
</body>
</html>